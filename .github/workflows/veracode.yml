trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- script:
    sleep 1
  displayName: 'Build'


- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(system.defaultworkingdirectory)'
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
    replaceExistingArchive: true

  Veracode-SAST-Pipeline-Scan:
    runs-on: ubuntu-latest
    container:
      image: veracode/pipeline-scan:latest
      options: --user root
    steps:
      - uses: actions/checkout@v2
      - name: Build Project
        run: |
          # Execute o comando para empacotar a origem do reposit√≥rio
          ./veracode package --source https://github.com/matthlimax/NodeGoat --type repo --trust
      - name: Package Code
        run: |
          zip -r uploadToVeracode.zip . -x "*node_modules*" "*.git*" -i "*.js" "*.html" "*.htm" "*.ts" "*.tsx" "*.json" "*.css" "*.jsp" "*.vue"
      - name: Scan with Veracode SAST Pipeline Scan
        run: |
          java -jar /opt/veracode/pipeline-scan.jar -vid "${{ secrets.VERACODE_ID }}" -vkey "${{ secrets.VERACODE_KEY }}" -f uploadToVeracode.zip
